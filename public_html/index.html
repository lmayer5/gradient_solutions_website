<!DOCTYPE html>
<html lang="en" data-theme="night" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradient Solutions | Premium Audio Plugins</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS & DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6', // Primary Blue
                            600: '#2563eb',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        secondary: {
                            50: '#faf5ff',
                            500: '#a855f7', // Secondary Purple
                            900: '#581c87',
                        }
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    }
                }
            },
            daisyui: {
                themes: ["night"],
            },
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .glass-panel {
                @apply bg-white/10 backdrop-blur-md border border-white/20;
            }
        }
    </style>

    <!-- Alpine.js Initialization (Must be before Alpine loads) -->
    <script>
        document.addEventListener('alpine:init', () => {
            console.log('Alpine Initializing...');

            // SETTINGS STORE
            Alpine.store('settings', {
                address: '',
                email: '',
                phone: '',
                about_title: '',
                about_text: '',
                faq: [],
                init() {
                    fetch('get_settings.php')
                        .then(res => res.json())
                        .then(data => {
                            this.address = data.address || '';
                            this.email = data.email || '';
                            this.phone = data.phone || '';
                            this.about_title = data.about_title || '';
                            this.about_text = data.about_text || '';
                            this.faq = data.faq || [];
                        });
                }
            });

            // CATALOG STORE (Renamed from 'products' to avoid conflict with DOM element id="products")
            // CATALOG STORE
            Alpine.store('catalog', {
                // Gradient Solutions Plugin Catalog
                items: [
                    {
                        id: 'p_rhythm_bass',
                        name: "rhythm engine",
                        price: 0.00,
                        image: "product_photos/rhythm_engine.png",
                        desc: "Essential rhythm and bass engine for your DAW. Free forever.",
                        options: ['VST3', 'AU'],
                        badge: "Free"
                    },
                    {
                        id: 'p_melodic',
                        name: "melodic engine",
                        price: 0.00,
                        image: "product_photos/melody_engine.png",
                        desc: "Inspiring melodic engine to jumpstart your creativity.",
                        options: ['VST3', 'AU'],
                        badge: "Free"
                    },
                    {
                        id: 'p_stem_gen',
                        name: "stem generator",
                        price: 29.00,
                        image: "product_photos/stem_generator.png",
                        desc: "High quality stem generator for precise track isolation.",
                        options: ['VST3', 'AU'],
                        badge: "Popular"
                    },
                    {
                        id: 'p_reverse_synth',
                        name: "reverse synthesis",
                        price: 99.00,
                        image: "product_photos/reverse_synthesis.png",
                        desc: "Advanced reverse synthesis technology for accurate audio reconstruction.",
                        options: ['VST3', 'AU'],
                        badge: "Premium"
                    }
                ]
            });

            // CART STORE
            Alpine.store('cart', {
                items: [],
                drawerOpen: false,

                get count() {
                    return this.items.reduce((acc, item) => acc + item.quantity, 0);
                },

                // SIMPLE PRICING LOGIC
                get subtotal() {
                    return this.items.reduce((acc, item) => acc + (item.price * item.quantity), 0);
                },

                get shipping() {
                    return 0; // INCLUDED
                },

                get total() {
                    return this.subtotal; // Already included
                },

                add(product) {
                    const existing = this.items.find(i => i.id === product.id);
                    if (existing) {
                        existing.quantity++;
                    } else {
                        this.items.push({ ...product, quantity: 1 });
                    }
                    // Only open mobile drawer on small screens (< lg breakpoint)
                    if (window.innerWidth < 1024) {
                        this.drawerOpen = true;
                    }
                },

                remove(productId) {
                    this.items = this.items.filter(i => i.id !== productId);
                },

                updateQty(productId, amount) {
                    const item = this.items.find(i => i.id === productId);
                    if (item) {
                        item.quantity += amount;
                        if (item.quantity <= 0) {
                            this.remove(productId);
                        }
                    }
                },

                clear() {
                    this.items = [];
                    // Keep invoiceData briefly if needed, or clear it
                },

                toggleDrawer() {
                    this.drawerOpen = !this.drawerOpen;
                }
            });

            // CHECKOUT FORM COMPONENT LOGIC
            Alpine.data('checkoutForm', () => ({
                formData: {
                    name: '',
                    email: '',
                    address: '',
                    github_username: ''
                },
                isSubmitting: false,
                touched: {
                    name: false,
                    email: false,
                    address: false,
                    github_username: false
                },

                get isNameValid() { return this.formData.name.trim().length > 0; },
                get isEmailValid() { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.formData.email); },
                get isAddressValid() { return this.formData.address.trim().length > 5; },
                get isGithubValid() { return this.formData.github_username.trim().length > 0; },
                get isValid() { return this.isNameValid && this.isEmailValid && this.isAddressValid && this.isGithubValid && Alpine.store('cart').items.length > 0; },

                submit() {
                    this.touched.name = true;
                    this.touched.email = true;
                    this.touched.address = true;
                    this.touched.github_username = true;

                    if (!this.isValid) return;

                    this.isSubmitting = true;

                    setTimeout(() => {
                        const cartStore = Alpine.store('cart');
                        const payload = {
                            customer: { ...this.formData },
                            cart: cartStore.items,
                            total: cartStore.total,
                            timestamp: new Date().toISOString()
                        };

                        const invoiceId = 'INV-' + Math.floor(Math.random() * 100000);
                        const dateStr = new Date().toLocaleDateString();

                        // GENRATE HTML FOR BLOB (Clean Inline Styles)
                        const rows = cartStore.items.map(item => `
                            <tr style="border-bottom: 1px solid #eeeeee;">
                                <td style="padding: 12px; font-family: sans-serif; color: #000000;">
                                    <div style="font-weight: bold; color: #000000;">${item.name}</div>
                                    <div style="font-size: 10px; color: #888888;">#${item.id}</div>
                                </td>
                                <td style="padding: 12px; text-align: right; color: #000000; font-family: sans-serif;">$${item.price.toFixed(2)}</td>
                                <td style="padding: 12px; text-align: center; color: #000000; font-family: sans-serif;">${item.quantity}</td>
                                <td style="padding: 12px; text-align: right; font-weight: bold; color: #000000; font-family: sans-serif;">$${(item.price * item.quantity).toFixed(2)}</td>
                            </tr>
                        `).join('');

                        const invoiceHTML = `
                            <div style="font-family: sans-serif; background-color: #ffffff; color: #000000; padding: 20px; width: 700px; box-sizing: border-box; margin: 0 auto;">
                                <!-- Header -->
                                <div style="display: flex; justify-content: space-between; border-bottom: 4px solid #4f46e5; padding-bottom: 30px; margin-bottom: 30px;">
                                    <div>
                                        <!-- Header with Gradient Solutions Branding -->
                                        <h1 style="color: #3730a3; margin: 0; font-size: 24px; font-weight: bold;">Gradient Solutions</h1>
                                        <p style="color: #666666; font-size: 14px; margin-top: 5px;">
                                            Luke Mayer - Chief Audio Engineer<br>
                                            ${Alpine.store('settings').email}<br>
                                            ${Alpine.store('settings').phone}
                                        </p>
                                    </div>
                                    <div style="text-align: right;">
                                        <h2 style="margin: 0; color: #cccccc; letter-spacing: 2px; font-size: 30px; font-weight: bold;">INVOICE</h2>
                                        <p style="margin: 5px 0 0; color: #000000; font-weight: bold;">${invoiceId}</p>
                                        <p style="margin: 0; color: #888888;">${dateStr}</p>
                                    </div>
                                </div>

                                <!-- Bill To -->
                                <div style="background-color: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #eeeeee;">
                                    <h3 style="margin: 0 0 10px; font-size: 16px; border-bottom: 1px solid #eeeeee; padding-bottom: 5px; color: #000000; font-weight: bold;">Bill To:</h3>
                                    <p style="font-weight: bold; margin: 0; font-size: 18px; color: #000000;">${this.formData.name}</p>
                                    <p style="margin: 0; color: #555555;">${this.formData.email}</p>
                                    <p style="margin: 5px 0 0; color: #555555;">${this.formData.address}</p>
                                </div>

                                <!-- Table -->
                                <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                                    <thead>
                                    <thead>
                                        <tr style="background-color: #eef2ff; color: #3730a3; text-align: left;">
                                            <th style="padding: 12px; font-weight: bold;">Item</th>
                                            <th style="padding: 12px; text-align: right; font-weight: bold;">Price</th>
                                            <th style="padding: 12px; text-align: center; font-weight: bold;">Qty</th>
                                            <th style="padding: 12px; text-align: right; font-weight: bold;">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${rows}
                                    </tbody>
                                </table>

                                <!-- Totals -->
                                <div style="display: flex; justify-content: flex-end; margin-top: 30px;">
                                    <div style="width: 50%;">
                                        <div style="display: flex; justify-content: space-between; padding: 15px 0; font-size: 20px; border-top: 2px solid #22c55e;">
                                            <span style="color: #166534; font-weight: bold;">Total (CAD)</span>
                                            <span style="color: #16a34a; font-weight: bold;">$${cartStore.total.toFixed(2)}</span>
                                        </div>
                                        <div style="text-align: right; color: #999999; font-size: 10px;">* Shipping and Applicable Taxes Included.</div>
                                    </div>
                                </div>

                                <!-- Payment Instructions -->
                                <div style="margin-top: 40px; padding: 20px; background-color: #f0fdf4; border-radius: 8px; text-align: center;">
                                    <p style="color: #3730a3; font-weight: bold; margin: 0 0 10px 0;">Payment Instructions</p>
                                    <p style="color: #374151; font-size: 14px; margin: 0;">Verified Digital Purchase. No further action required.</p>
                                </div>

                                <!-- Thank You -->
                                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eeeeee; text-align: center; color: #999999; font-size: 12px;">Thank you for your business!</div>
                            </div>
                        `;








                        // 1. Create Clean Room Iframe
                        const iframe = document.createElement('iframe');
                        iframe.style.visibility = 'hidden';
                        iframe.style.position = 'fixed';
                        iframe.style.left = '-9999px';
                        iframe.style.top = '0';
                        iframe.style.border = 'none';
                        document.body.appendChild(iframe);

                        // 2. Define callback for when PDF is ready
                        window.handlePdfGenerated = (blob) => {
                            console.log('PDF Generated via Clean Room. Blob size:', blob.size);

                            // Cleanup callback and iframe
                            delete window.handlePdfGenerated;
                            if (document.body.contains(iframe)) document.body.removeChild(iframe);

                            const formData = new FormData();
                            formData.append('customer_name', this.formData.name);
                            formData.append('customer_email', this.formData.email);
                            formData.append('github_username', this.formData.github_username);
                            formData.append('order_json', JSON.stringify(payload));
                            formData.append('invoice_pdf', blob, 'invoice.pdf');

                            console.log('Sending request to process_order.php...');

                            fetch('process_order.php', {
                                method: 'POST',
                                body: formData
                            })
                                .then(response => {
                                    if (response.ok) {
                                        return response.json().catch(() => ({ status: 'success' }));
                                    }
                                    throw new Error('Network response was not ok: ' + response.statusText);
                                })
                                .then(data => {
                                    console.log('Success:', data);
                                    document.getElementById('order_success_modal').showModal();
                                    Alpine.store('cart').clear();
                                    this.formData = { name: '', email: '', address: '', github_username: '' };
                                    this.touched = { name: false, email: false, address: false, github_username: false };
                                })
                                .catch(error => {
                                    console.error('Submission Error:', error);
                                    alert('Order Error: ' + error.message);
                                })
                                .finally(() => {
                                    this.isSubmitting = false;
                                    Alpine.store('cart').drawerOpen = false;
                                });
                        };

                        // 3. Construct Clean HTML Document
                        const cleanHtml = `
                            <html>
                            <head>
                                <style>body { margin: 0; font-family: sans-serif; }</style>
                                <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script>
                            </head>
                            <body>
                                ${invoiceHTML}
                                <script>
                                    window.onload = function() {
                                        const opt = {
                                            margin: 0.5,
                                            filename: 'gradient-invoice.pdf',
                                            image: { type: 'jpeg', quality: 0.98 },
                                            html2canvas: { scale: 2, useCORS: true, logging: true },
                                            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                                        };
                                        html2pdf().set(opt).from(document.body).output('blob').then(blob => {
                                            window.parent.handlePdfGenerated(blob);
                                        }).catch(err => {
                                            console.error('Inner PDF Error:', err);
                                            window.parent.alert('PDF Generation Error (Inner): ' + err.message);
                                        });
                                    };
                                <\/script>
                            </body>
                            </html>
                        `;

                        // 4. Inject Content
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        iframeDoc.open();
                        iframeDoc.write(cleanHtml);
                        iframeDoc.close();

                        console.log('Clean Room initialized. Waiting for PDF...');

                    }, 500);
                }
            }));
        });
    </script>

    <!-- Alpine.js Core -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>


    <style>
        [x-cloak] {
            display: none !important;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Invoice Print Styles */
        #invoice-template {
            width: 800px;
            background-color: #ffffff !important;
            color: #000000 !important;
            padding: 40px;
            display: none;
            /* Hidden by default */
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            border: 1px solid #ccc;
            /* Ensure boundaries */
        }

        /* STRICT Hex colors for PDF generation */
        #invoice-template * {
            border-color: #e5e7eb !important;
            /* gray-200 */
        }

        #invoice-template .text-brand-700 {
            color: #1d4ed8 !important;
            /* Blue-700 */
        }

        #invoice-template .text-brand-600 {
            color: #2563eb !important;
            /* Blue-600 */
        }

        #invoice-template .bg-brand-50 {
            background-color: #eff6ff !important;
            /* Blue-50 */
        }

        #invoice-template .text-brand-500 {
            color: #3b82f6 !important;
            /* Blue-500 */
        }

        #invoice-template .bg-brand-500 {
            background-color: #3b82f6 !important;
            /* Blue-500 */
        }

        #invoice-template .border-brand-500 {
            border-color: #3b82f6 !important;
            /* Blue-500 */
        }

        #invoice-template .text-gray-500 {
            color: #6b7280 !important;
        }

        #invoice-template .text-gray-700 {
            color: #374151 !important;
        }

        #invoice-template .text-gray-200 {
            color: #e5e7eb !important;
        }

        #invoice-template .text-gray-400 {
            color: #9ca3af !important;
        }

        #invoice-template .text-gray-800 {
            color: #1f2937 !important;
        }

        #invoice-template .bg-gray-50 {
            background-color: #f9fafb !important;
        }

        /* Helper to ensure text rendering */
        #invoice-template p,
        #invoice-template span,
        #invoice-template h1,
        #invoice-template h2,
        #invoice-template h3,
        #invoice-template td {
            -webkit-font-smoothing: antialiased;
            color: inherit;
        }

        #invoice-template.generating {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: -10;
        }
    </style>
</head>

<body x-data
    class="bg-base-200 min-h-screen flex flex-col font-sans text-base-content selection:bg-brand-500 selection:text-white">

    <!-- DEBUG INDICATOR (Will only show if things are broken) -->
    <div x-show="!$store.catalog" class="bg-red-500 text-white text-center p-2 font-bold z-[9999]">
        CRITICAL ERROR: Alpine Store 'catalog' NOT Loaded
    </div>

    <!-- INVOICE GENERATION LOGIC IS NOW HANDLED VIA JAVASCRIPT IN SUBMIT() -->
    <!-- This avoids Alpine scope issues and Tailwind 'oklch' color crashes by generating clean HTML on demand. -->

    <!-- DRAWER WRAPPER (For Mobile Cart) -->
    <div class="drawer drawer-end">
        <!-- We use $store.cart.drawerOpen to control explicitly via data, but DaisyUI drawer uses a checkbox -->
        <!-- We bind the checkbox check state to the store -->
        <input id="cart-drawer" type="checkbox" class="drawer-toggle" :checked="$store.cart.drawerOpen"
            @change="$store.cart.drawerOpen = $el.checked" />

        <!-- PAGE CONTENT -->
        <div class="drawer-content flex flex-col">

            <!-- Navbar -->
            <div class="sticky top-0 z-50 glass-panel shadow-sm">
                <div class="navbar container mx-auto px-4 py-3">
                    <div class="flex-1">
                        <a href="#" class="btn btn-ghost h-auto hover:bg-transparent px-0">
                            <!-- Logo Image -->
                            <div class="text-3xl font-bold text-brand-500 tracking-tighter lowercase">gradient</div>
                            <span class="sr-only">gradient solutions</span>
                        </a>
                    </div>
                    <div class="flex-none gap-2">
                        <!-- Desktop Menu -->
                        <ul class="menu menu-horizontal px-1 hidden md:flex font-medium text-base-content/70">
                            <li><a href="#products">plugins</a></li>
                            <li><a href="#about">about</a></li>
                        </ul>

                        <!-- Cart Button Mobile -->
                        <label for="cart-drawer" class="btn btn-ghost btn-circle md:hidden">
                            <div class="indicator">
                                <i class="fa-solid fa-cart-shopping text-xl"></i>
                                <span class="badge badge-sm badge-primary indicator-item" x-show="$store.cart.count > 0"
                                    x-text="$store.cart.count"></span>
                            </div>
                        </label>

                        <!-- Desktop Cart Trigger -->
                        <button class="btn btn-ghost btn-circle hidden md:inline-flex"
                            onclick="document.getElementById('cart-sidebar-section').scrollIntoView({behavior: 'smooth'})">
                            <div class="indicator">
                                <i class="fa-solid fa-cart-shopping text-xl"></i>
                                <span class="badge badge-sm badge-primary indicator-item" x-show="$store.cart.count > 0"
                                    x-text="$store.cart.count"></span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Hero Section -->
            <div class="hero min-h-[85vh] relative"
                style="background-image: url('https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?q=80&w=1920&auto=format&fit=crop');">
                <!-- Darker, richer gradient for premium feel and high contrast -->
                <div class="hero-overlay bg-gradient-to-br from-black/90 via-gray-900/80 to-brand-900/60"></div>

                <div class="hero-content text-center text-neutral-content w-full py-20">
                    <div class="max-w-5xl">
                        <!-- Premium Badge -->
                        <div
                            class="inline-block mb-6 px-4 py-1.5 rounded-full border border-white/30 bg-white/10 backdrop-blur-md text-sm font-medium tracking-wider uppercase text-brand-100 animate-pulse">
                            official gradient solutions store
                        </div>

                        <!-- Main Headline with tight leading -->
                        <h1
                            class="mb-6 text-6xl md:text-7xl lg:text-8xl font-bold text-white leading-tight tracking-tight drop-shadow-xl">
                            sculpt your sound.<br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-300 to-white">perfect
                                your mix.</span>
                        </h1>

                        <!-- Subhead -->
                        <p class="mb-10 text-xl md:text-2xl text-gray-200 max-w-2xl mx-auto font-light leading-relaxed">
                            premium audio plugins designed for modern producers. experience analog warmth with
                            digital precision.
                        </p>

                        <!-- CTA Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-16">
                            <a href="#products"
                                class="btn btn-primary border-none bg-brand-600 hover:bg-brand-500 text-white btn-lg rounded-full px-12 shadow-[0_0_30px_rgba(59,130,246,0.4)] hover:shadow-[0_0_40px_rgba(59,130,246,0.6)] hover:-translate-y-1 transition-all duration-300">
                                shop collection
                            </a>
                            <a href="#about"
                                class="btn btn-ghost text-white border-white/30 hover:bg-white/10 btn-lg rounded-full px-8">
                                learn more
                            </a>
                        </div>

                        <!-- Features Floating Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left relative z-10">
                            <!-- Card 1 -->
                            <div
                                class="group p-6 rounded-2xl bg-black/40 backdrop-blur-md border border-white/10 hover:bg-white/10 hover:border-white/30 transition-all duration-300">
                                <div
                                    class="w-12 h-12 rounded-full bg-brand-500/20 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-wave-square text-brand-400 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-bold text-white mb-2">analog warmth</h3>
                                <p class="text-sm text-gray-300">proprietary modeling technology that captures the soul
                                    of vintage hardware.</p>
                            </div>

                            <!-- Card 2 -->
                            <div
                                class="group p-6 rounded-2xl bg-black/40 backdrop-blur-md border border-white/10 hover:bg-white/10 hover:border-white/30 transition-all duration-300">
                                <div
                                    class="w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-microchip text-blue-400 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-bold text-white mb-2">zero latency</h3>
                                <p class="text-sm text-gray-300">optimized c++ dsp engines for real-time tracking
                                    performance.</p>
                            </div>

                            <!-- Card 3 -->
                            <div
                                class="group p-6 rounded-2xl bg-black/40 backdrop-blur-md border border-white/10 hover:bg-white/10 hover:border-white/30 transition-all duration-300">
                                <div
                                    class="w-12 h-12 rounded-full bg-orange-500/20 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-sliders text-orange-400 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-bold text-white mb-2">professional presets</h3>
                                <p class="text-sm text-gray-300">signature presets crafted for professional workflows
                                    included with every
                                    plugin.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scroll Indicator -->
        <div class="absolute bottom-6 left-1/2 -translate-x-1/2 animate-bounce opacity-70">
            <i class="fa-solid fa-chevron-down text-white text-xl"></i>
        </div>
    </div>

    <!-- Main Layout: Grid vs Sidebar -->
    <div class="container mx-auto px-4 py-12 flex flex-col lg:flex-row gap-8 relative" id="products">

        <!-- Product Grid (Left/Main) -->
        <div class="flex-1">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-base-content/90">our collection</h2>

                <!-- Toggle Removed - Retail Only Mode -->


                <div class="badge badge-outline p-3" x-show="$store.catalog">
                    showing <span x-text="$store.catalog.items.length" class="mx-1 font-bold"></span> items
                </div>
            </div>

            <!-- Debugging / Fallback -->
            <div x-show="!$store.catalog || $store.catalog.items.length === 0" class="alert alert-warning">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <span>No products loaded. Check console for 'Catalog store registered'.</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-6">
                <template x-for="product in $store.catalog.items" :key="product.id">
                    <div x-data="{ selectedOpt: product.options ? product.options[0] : null }"
                        class="card bg-base-100 shadow-xl hover:shadow-2xl transition-all duration-300 group border border-base-200">
                        <figure
                            class="relative overflow-hidden h-64 bg-base-300 group-hover:bg-base-200 transition-colors duration-500">
                            <img :src="product.image" :alt="product.name"
                                class="w-full h-full object-contain p-4 transition-all duration-500 transform group-hover:scale-105"
                                loading="lazy" />
                            <div x-show="product.badge" class="absolute top-3 right-3 badge badge-secondary shadow-md"
                                x-text="product.badge"></div>
                        </figure>
                        <div class="card-body p-6">
                            <div class="flex justify-between items-start">
                                <h2 class="card-title text-lg font-bold" x-text="product.name"></h2>
                                <span class="text-brand-600 font-bold text-lg"
                                    x-text="'$' + product.price.toFixed(2)"></span>
                            </div>
                            <p class="text-sm text-base-content/70 mt-2" x-text="product.desc"></p>

                            <!-- Options Selector -->
                            <div x-show="product.options" class="mt-4">
                                <label class="label py-0"><span class="label-text-alt font-semibold">Select
                                        Format</span></label>
                                <select x-model="selectedOpt" class="select select-bordered select-sm w-full mt-1">
                                    <template x-for="opt in product.options" :key="opt">
                                        <option :value="opt" x-text="opt"></option>
                                    </template>
                                </select>
                            </div>

                            <div class="card-actions justify-end mt-6">
                                <button @click="$store.cart.add({
                                            ...product, 
                                            // image is already on product, but ensure ID is unique
                                            id: selectedOpt ? product.id + '_' + selectedOpt : product.id,
                                            name: selectedOpt ? product.name + ' (' + selectedOpt + ')' : product.name
                                        })" class="btn btn-primary btn-sm w-full gap-2 hover:bg-brand-700 text-white">
                                    <i class="fa-solid fa-plus"></i> add to cart
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Desktop Cart Sidebar (Hidden on mobile/tablet, visible on lg) -->
        <aside class="hidden lg:block w-96 relative" id="cart-sidebar-section">
            <div class="sticky top-24 space-y-6">
                <div x-data="checkoutForm" class="bg-base-100 rounded-2xl shadow-xl border border-base-200 p-6">

                    <div class="flex items-center justify-between mb-6 border-b border-base-200 pb-4">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <i class="fa-solid fa-cart-shopping text-brand-500"></i> your cart
                        </h3>
                        <span class="badge badge-ghost font-mono" x-text="$store.cart.count + ' items'"></span>
                    </div>

                    <div x-show="$store.cart.items.length === 0"
                        class="text-center py-10 flex flex-col items-center text-base-content/50">
                        <i class="fa-solid fa-basket-shopping text-4xl mb-3 opacity-20"></i>
                        <p>your cart is empty.</p>
                    </div>

                    <div class="space-y-4 max-h-[30vh] overflow-y-auto pr-2 custom-scrollbar"
                        x-show="$store.cart.items.length > 0">
                        <template x-for="item in $store.cart.items" :key="item.id">
                            <div class="flex gap-3 bg-base-50 p-3 rounded-lg border border-base-100 group">
                                <img :src="item.image" class="w-16 h-16 rounded-md object-cover bg-gray-200" />
                                <div class="flex-1 flex flex-col justify-between">
                                    <div class="flex justify-between items-start">
                                        <h4 class="font-bold text-sm line-clamp-1" x-text="item.name"></h4>
                                        <button @click="$store.cart.remove(item.id)"
                                            class="text-error opacity-0 group-hover:opacity-100 transition-opacity text-xs"><i
                                                class="fa-solid fa-trash"></i></button>
                                    </div>
                                    <div class="flex justify-between items-center mt-1">
                                        <div
                                            class="flex items-center gap-2 bg-white rounded-lg border border-base-200 px-1 py-0.5 shadow-sm">
                                            <button @click="$store.cart.updateQty(item.id, -1)"
                                                class="btn btn-ghost btn-xs btn-circle h-5 w-5 min-h-0">-</button>
                                            <span class="text-xs font-mono w-4 text-center"
                                                x-text="item.quantity"></span>
                                            <button @click="$store.cart.updateQty(item.id, 1)"
                                                class="btn btn-ghost btn-xs btn-circle h-5 w-5 min-h-0">+</button>
                                        </div>
                                        <div class="font-bold text-sm"
                                            x-text="'$' + (item.price * item.quantity).toFixed(2)"></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <div class="mt-6 pt-4 border-t border-base-200" x-show="$store.cart.items.length > 0">
                        <div class="flex justify-between text-sm mb-2 text-base-content/70">
                            <span>subtotal (cad)</span>
                            <span class="font-bold" x-text="'$' + $store.cart.baseSubtotal.toFixed(2)"></span>
                        </div>
                        <div class="flex justify-between text-sm mb-2 text-success" x-show="$store.cart.discount > 0">
                            <span>bundle savings</span>
                            <span class="font-bold" x-text="'-$' + $store.cart.discount.toFixed(2)"></span>
                        </div>

                        <div class="flex justify-between text-lg font-bold mb-2">
                            <span>total (cad)</span>
                            <span class="text-brand-600" x-text="'$' + $store.cart.total.toFixed(2)"></span>
                        </div>
                        <div class="text-xs text-center text-gray-400 mb-6">
                            prices in canadian dollars.
                        </div>

                        <form @submit.prevent="submit" class="space-y-4">
                            <div class="form-control">
                                <label class="label"><span class="label-text font-medium">Full
                                        Name</span></label>
                                <input type="text" x-model="formData.name"
                                    class="input input-bordered w-full focus:input-primary transition-all"
                                    :class="{'input-error': touched.name && !isNameValid}" placeholder="Hans Zimmer" />
                                <span x-show="touched.name && !isNameValid" class="text-error text-xs mt-1 ml-1">Name is
                                    required</span>
                            </div>

                            <div class="form-control">
                                <label class="label"><span class="label-text font-medium">Email
                                        Address</span></label>
                                <input type="email" x-model="formData.email"
                                    class="input input-bordered w-full focus:input-primary transition-all"
                                    :class="{'input-error': touched.email && !isEmailValid}"
                                    placeholder="studio@gradientsolutions.ca" />
                                <span x-show="touched.email && !isEmailValid" class="text-error text-xs mt-1 ml-1">Valid
                                    email required</span>
                            </div>

                            <div class="form-control">
                                <label class="label"><span class="label-text font-medium">Billing
                                        Address</span></label>
                                <textarea x-model="formData.address"
                                    class="textarea textarea-bordered h-20 focus:textarea-primary transition-all"
                                    :class="{'textarea-error': touched.address && !isAddressValid}"
                                    placeholder="Studio 42, Music Row, Nashville, TN"></textarea>
                                <span x-show="touched.address && !isAddressValid"
                                    class="text-error text-xs mt-1 ml-1">Address is required (>5 chars)</span>
                            </div>

                            <div class="form-control">
                                <label class="label"><span class="label-text font-medium">GitHub
                                        Username</span></label>
                                <input type="text" x-model="formData.github_username"
                                    class="input input-bordered w-full focus:input-primary transition-all"
                                    :class="{'input-error': touched.github_username && !isGithubValid}"
                                    placeholder="e.g., hanszimmer-studio" />
                                <span x-show="touched.github_username && !isGithubValid"
                                    class="text-error text-xs mt-1 ml-1">GitHub username required for delivery</span>
                            </div>

                            <button type="submit" :disabled="isSubmitting"
                                class="btn btn-primary w-full text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all mt-2">
                                <span x-show="isSubmitting" class="loading loading-spinner"></span>
                                <span x-show="!isSubmitting">Place Order</span>
                                <i x-show="!isSubmitting" class="fa-solid fa-arrow-right"></i>
                            </button>
                        </form>
                    </div>

                </div>

                <div class="bg-base-100 p-4 rounded-xl border border-base-200 flex justify-around text-center">
                    <div class="flex flex-col items-center gap-2">
                        <i class="fa-solid fa-bolt text-brand-500"></i>
                        <span class="text-xs font-semibold">Fast DSP</span>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <i class="fa-solid fa-shield-halved text-brand-500"></i>
                        <span class="text-xs font-semibold">Secure</span>
                    </div>
                </div>

            </div>
        </aside>
    </div>

    <div id="about" class="bg-base-200" x-show="$store.settings.about_title">
        <div class="container mx-auto px-4 max-w-xl py-24">
            <!-- About Section Card -->
            <div class="glass-panel rounded-3xl overflow-hidden shadow-2xl mb-12 animate-fade-in">
                <div class="p-8 md:p-16 text-center">
                    <div
                        class="w-20 h-20 bg-brand-500/20 rounded-2xl flex items-center justify-center mx-auto mb-8 rotate-3 hover:rotate-0 transition-transform duration-300">
                        <i class="fa-solid fa-wave-square font-bold text-4xl text-brand-400"></i>
                    </div>
                    <h2 class="text-4xl md:text-5xl font-bold text-white mb-8 tracking-tight"
                        x-text="$store.settings.about_title"></h2>
                    <div class="prose prose-lg prose-invert mx-auto text-gray-300 whitespace-pre-wrap font-light leading-relaxed"
                        x-text="$store.settings.about_text"></div>
                </div>
            </div>

            <!-- FAQ Section -->
            <div id="faq" class="py-12" x-show="$store.settings.faq && $store.settings.faq.length > 0">
                <div class="max-w-3xl mx-auto">
                    <h2 class="text-3xl font-bold text-center text-white mb-12 tracking-tight">frequently asked
                        questions</h2>
                    <div class="space-y-4">
                        <template x-for="(item, index) in $store.settings.faq" :key="index">
                            <div
                                class="collapse collapse-arrow bg-base-300/50 backdrop-blur-sm border border-white/10 rounded-2xl shadow-sm hover:border-brand-500/30 transition-colors">
                                <input type="radio" name="faq-accordion" />
                                <div class="collapse-title text-xl font-semibold text-white/90 py-5"
                                    x-text="item.question">
                                </div>
                                <div class="collapse-content px-5 pb-5">
                                    <p class="text-gray-400 leading-relaxed font-light" x-text="item.answer"></p>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- End of About Section -->
    </div> <!-- End of drawer-content -->

    <!-- DRAWER SIDE (Mobile Cart Overlay) - MUST be inside drawer wrapper -->
    <div class="drawer-side z-50">
        <label for="cart-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        <div class="p-4 w-80 md:w-96 min-h-full bg-base-100 text-base-content flex flex-col">

            <div class="flex items-center justify-between mb-6 pb-4 border-b">
                <h3 class="font-bold text-xl">your bag</h3>
                <button class="btn btn-sm btn-circle btn-ghost" @click="$store.cart.drawerOpen = false">âœ•</button>
            </div>

            <div class="flex-1 overflow-y-auto mb-4" x-show="$store.cart.items.length > 0">
                <div class="space-y-4">
                    <template x-for="item in $store.cart.items" :key="item.id">
                        <div class="flex gap-3 bg-base-50 p-2 rounded-lg border border-base-200">
                            <img :src="item.image" class="w-16 h-16 rounded object-cover" />
                            <div class="flex-1">
                                <div class="flex justify-between">
                                    <p class="font-bold text-sm" x-text="item.name"></p>
                                    <button @click="$store.cart.remove(item.id)" class="text-error text-xs"><i
                                            class="fa-solid fa-trash"></i></button>
                                </div>
                                <div class="flex justify-between items-center mt-2">
                                    <div class="join join-horizontal">
                                        <button @click="$store.cart.updateQty(item.id, -1)"
                                            class="join-item btn btn-xs">-</button>
                                        <button class="join-item btn btn-xs bg-white pointer-events-none"
                                            x-text="item.quantity"></button>
                                        <button @click="$store.cart.updateQty(item.id, 1)"
                                            class="join-item btn btn-xs">+</button>
                                    </div>
                                    <span class="font-bold text-sm"
                                        x-text="'$' + (item.price * item.quantity).toFixed(2)"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="$store.cart.items.length === 0"
                class="flex-1 flex flex-col items-center justify-center opacity-50">
                <i class="fa-solid fa-cart-shopping text-6xl mb-4"></i>
                <p>cart is empty</p>
                <button class="btn btn-sm btn-primary mt-4" @click="$store.cart.drawerOpen = false">start
                    shopping</button>
            </div>

            <div class="mt-auto border-t pt-4" x-show="$store.cart.items.length > 0" x-data="checkoutForm">
                <div class="flex justify-between font-bold text-lg mb-1">
                    <span>total (cad)</span>
                    <span x-text="'$' + $store.cart.total.toFixed(2)"></span>
                </div>
                <div class="text-xs text-center text-gray-500 mb-4">taxes included</div>

                <form @submit.prevent="submit" class="space-y-3">
                    <input type="text" x-model="formData.name" placeholder="Name"
                        class="input input-sm input-bordered w-full" required
                        :class="{'input-error': touched.name && !isNameValid}" />
                    <input type="email" x-model="formData.email" placeholder="Email"
                        class="input input-sm input-bordered w-full" required
                        :class="{'input-error': touched.email && !isEmailValid}" />
                    <textarea x-model="formData.address" placeholder="Billing Address"
                        class="textarea textarea-sm textarea-bordered w-full" required
                        :class="{'textarea-error': touched.address && !isAddressValid}"></textarea>
                    <input type="text" x-model="formData.github_username" placeholder="GitHub Username"
                        class="input input-sm input-bordered w-full" required
                        :class="{'input-error': touched.github_username && !isGithubValid}" />

                    <button type="submit" :disabled="isSubmitting" class="btn btn-primary w-full shadow-lg">
                        <span x-show="isSubmitting" class="loading loading-spinner loading-xs"></span>
                        Place Order
                    </button>
                </form>
            </div>
        </div>
    </div>
    </div> <!-- End of drawer wrapper -->

    <!-- Success Modal -->
    <dialog id="order_success_modal" class="modal modal-bottom sm:modal-middle">
        <div class="modal-box relative bg-base-100 border border-base-200">
            <label for="order_success_modal" class="btn btn-sm btn-circle absolute right-2 top-2"
                @click="document.getElementById('order_success_modal').close()">âœ•</label>
            <div class="text-center">
                <div class="w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa-solid fa-wave-square font-bold text-4xl text-brand-600"></i>
                </div>
                <h3 class="text-lg font-bold text-brand-700">Order Placed Successfully!</h3>
                <p class="py-4 text-base-content/70">Thank you for shopping with Gradient Solutions. An invoice and your
                    download links have
                    been verified and emailed to you.</p>
                <div class="modal-action justify-center">
                    <form method="dialog">
                        <button class="btn btn-wide btn-outline">Continue Shopping</button>
                    </form>
                </div>
            </div>
    </dialog>

    <!-- Mix Error Modal -->
    <dialog id="mix_error_modal" class="modal">
        <div class="modal-box">
            <h3 class="font-bold text-lg text-error"><i class="fa-solid fa-circle-exclamation mr-2"></i>Cart Error</h3>
            <p class="py-4">There was an issue with the items in your cart.</p>
            <p class="text-sm">Please review your selection or clear your cart to start over.</p>
            <div class="modal-action">
                <form method="dialog">
                    <button class="btn btn-ghost">Cancel</button>
                    <button class="btn btn-error text-white" @click="Alpine.store('cart').clear()">Clear Cart</button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Footer -->
    <footer class="bg-base-200 text-base-content border-t border-base-300 mt-12">
        <div class="container mx-auto p-10 grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
            <div class="mb-4 md:mb-0">
                <div class="text-2xl font-bold text-brand-500 tracking-tighter lowercase">gradient</div>
                <p class="text-sm text-base-content/60 mt-1">Â© 2025 gradient solutions.<br>all rights reserved.</p>
            </div>
            <div>
                <span class="footer-title opacity-100 text-brand-800">contact us</span>
                <div class="flex flex-col gap-2 mt-2 text-sm" x-data>
                    <div class="flex items-center gap-2 justify-center md:justify-start">
                        <i class="fa-solid fa-location-dot text-brand-500 w-4"></i>
                        <span x-text="$store.settings.address || 'Loading...'"></span>
                    </div>
                    <div class="flex items-center gap-2 justify-center md:justify-start">
                        <i class="fa-solid fa-envelope text-brand-500 w-4"></i>
                        <span x-text="$store.settings.email || 'Loading...'"></span>
                    </div>
                    <div class="flex items-center gap-2 justify-center md:justify-start">
                        <i class="fa-solid fa-phone text-brand-500 w-4"></i>
                        <span x-text="$store.settings.phone || 'Loading...'"></span>
                    </div>
                </div>
            </div>
            <div>
                <span class="footer-title opacity-100 text-brand-800">legal</span>
                <a class="link link-hover text-sm">terms of service</a>
                <a class="link link-hover text-sm">privacy policy</a>
                <a class="link link-hover text-sm">license agreement</a>
            </div>
        </div>
        <div class="footer footer-center p-4 bg-base-300 text-base-content text-xs">
            <div>
                <p>Â© 2025 gradient solutions. all rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Alpine Store for Settings -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.store('settings', {
                address: '123 tech avenue, toronto, on',
                email: 'hello@gradientsolutions.ca',
                phone: '416-555-0199',
                about_title: 'about gradient solutions',
                about_text: 'we create industry-leading audio plugins for music producers and sound engineers. our mission is to simplify your workflow while delivering analog-quality sound.',
                pricing: {
                    "1": 49, "2": 89, "3": 129, "4": 159, "5": 189, "6": 219, "extra": 30
                },

                // Compatibility mapping
                get aboutTitle() { return this.about_title; },
                get aboutText() { return this.about_text; },

                init() {
                    // Try to fetch latest from server, but defaults will show if this fails (e.g. running locally without server)
                    fetch('get_settings.php')
                        .then(res => res.json())
                        .then(data => {
                            this.address = data.address;
                            this.email = data.email;
                            this.phone = data.phone;
                            this.about_title = data.about_title;
                            this.about_text = data.about_text;
                            this.faq = data.faq || [];
                            this.pricing = data.pricing;
                        })
                        .catch(err => {
                            console.log('Using default settings (offline/local mode)');
                        });
                }
            });
        });
    </script>

</body>

</html>